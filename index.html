<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Mobile Galaga</title>
  <link rel="stylesheet" href="style.css?v=1.6" />
</head>
<body>  <!-- ë“œë¡­ë‹¤ìš´ ë²„íŠ¼ (START ë²„íŠ¼ ì™¼ìª½) -->
  <div id="sentenceDropdown">
    <button id="dropdownBtn">&#9662;</button>
    <div id="sentenceList" class="sentence-list">
      <!-- ì—¬ê¸°ì— ë¬¸ì¥ ëª©ë¡ì´ ë™ì ìœ¼ë¡œ ì¶”ê°€ë©ë‹ˆë‹¤ -->
    </div>
  </div>
  
  <!-- ìƒë‹¨ ì»¨íŠ¸ë¡¤ (ì¤‘ì•™ ê³ ì •) -->
  <div id="topControls">
    <button id="startBtn" class="start-btn">START</button>
    <button id="pauseBtn" class="pause-btn">PAUSE</button>
    <button id="stopBtn" class="stop-btn">STOP</button>
  </div>
  <!-- ë³¼ë¥¨ë²„íŠ¼: ì˜¤ë¥¸ìª½ ìƒë‹¨ì— ë³„ë„ ìœ„ì¹˜ -->
  <button id="volumeBtn" class="volume-btn">ğŸ”Š</button>  <!-- ë¬¸ì¥ ì´ë¯¸ì§€/ë™ì˜ìƒ í‘œì‹œë¥¼ ìœ„í•œ ì»¨í…Œì´ë„ˆ -->
  <div id="sentenceImageContainer" class="no-border-at-all" style="border:0 none transparent !important; box-shadow:none !important; outline:0 none transparent !important; background-color:transparent !important;">
    <img id="sentenceImage" class="no-border-at-all" src="" alt="Sentence Image" style="border:0 none transparent !important; outline:0 none transparent !important; border-radius:0 !important; box-shadow:none !important; background-color:transparent !important; padding:0; margin:0;" />
    <!-- ë™ì˜ìƒ ìš”ì†ŒëŠ” ìë°”ìŠ¤í¬ë¦½íŠ¸ì—ì„œ í•„ìš”í•  ë•Œ ë™ì ìœ¼ë¡œ ìƒì„±ë©ë‹ˆë‹¤ -->
  </div>

  <!-- ê²Œì„ ìº”ë²„ìŠ¤ -->
  <canvas id="gameCanvas"></canvas>

  <!-- ê¹€ íš¨ê³¼ë¥¼ ìœ„í•œ ìˆ¨ê²¨ì§„ ë¹„ë””ì˜¤ ìš”ì†Œ -->  <video id="coffeeSteamVideo" src="images/coffee6.webm" autoplay loop muted playsinline style="display: none;"></video>
  <script src="script.js"></script>
  <script src="dropdown.js"></script>
  <script src="sentenceImage.js"></script>
  <script>
    // ë™ì˜ìƒ í”Œë ˆì´ì–´ ì»¨íŠ¸ë¡¤ í–¥ìƒì„ ìœ„í•œ ì¶”ê°€ ìŠ¤í¬ë¦½íŠ¸
    document.addEventListener('DOMContentLoaded', function() {
      // ëª¨ë°”ì¼ í„°ì¹˜ ì´ë²¤íŠ¸ ìµœì í™”
      function setupVideoControls() {
        // ë¹„ë””ì˜¤ ìš”ì†Œ ì°¾ê¸° ë˜ëŠ” ë‚˜ì¤‘ì— ìƒì„±ë  ë•Œê¹Œì§€ ê¸°ë‹¤ë¦¬ê¸°
        const checkForVideo = setInterval(() => {
          const video = document.getElementById('sentenceVideo');
          if (video) {
            clearInterval(checkForVideo);
            console.log('ë¹„ë””ì˜¤ ìš”ì†Œ ë°œê²¬ - ì´ë²¤íŠ¸ ì²˜ë¦¬ ìµœì í™”');
            
            // í´ë¦­/í„°ì¹˜ í•¸ë“¤ëŸ¬ ì •ì˜
            const handleVideoInteraction = function(event) {
              // ëª¨ë“  ì´ë²¤íŠ¸ ì „íŒŒ ì¤‘ì§€ ë° ê¸°ë³¸ ë™ì‘ ë°©ì§€
              event.stopPropagation();
              event.preventDefault();
              event.stopImmediatePropagation();
              
              console.log('ë¹„ë””ì˜¤ ì¸í„°ë™ì…˜ ê°ì§€ - ìœ í˜•:', event.type);
              
              // íŠ¹ì • ì»¨íŠ¸ë¡¤ ìš”ì†Œ í´ë¦­ ì—¬ë¶€ í™•ì¸ 
              const isControlElement = event.target.closest && 
                (event.target.closest('*[id*="controls"]') || 
                 event.target.closest('*[class*="controls"]') ||
                 event.target.closest('button'));
                
              // ì»¨íŠ¸ë¡¤ ìš”ì†Œë¥¼ í´ë¦­í•œ ê²½ìš° ê¸°ë³¸ ë™ì‘ í—ˆìš©
              if (isControlElement) {
                console.log('ì»¨íŠ¸ë¡¤ ìš”ì†Œ ê°ì§€ - ì›ë˜ ê¸°ëŠ¥ ìœ ì§€');
                return true; // ê¸°ë³¸ ë™ì‘ í—ˆìš©
              }
              
              try {
                // ë¹„ë””ì˜¤ ì˜ì—­ ìì²´ë¥¼ í´ë¦­í•œ ê²½ìš°ì—ë§Œ ì¬ìƒ/ì¼ì‹œì •ì§€ í† ê¸€
                if (video.paused) {
                  // ì—¬ëŸ¬ ë°©ì‹ìœ¼ë¡œ ì¬ìƒ ì‹œë„
                  video.play().catch(error => {
                    console.log('ê¸€ë¡œë²Œ í•¸ë“¤ëŸ¬ ì¬ìƒ ì—ëŸ¬:', error);
                    
                    // ì¬ì‹œë„ - ì•½ê°„ ì§€ì—° í›„
                    setTimeout(() => {
                      video.muted = true; // ìŒì†Œê±° í›„ ì‹œë„
                      video.play().then(() => {
                        video.muted = false; // ì„±ê³µí•˜ë©´ ìŒì†Œê±° í•´ì œ
                      }).catch(e => console.log('ì¬ì‹œë„ ì‹¤íŒ¨:', e));
                    }, 100);
                  });
                } else {
                  video.pause();
                }
              } catch (e) {
                console.log('ë¹„ë””ì˜¤ ì œì–´ ì˜¤ë¥˜:', e);
              }
              
              // ì¼ì‹œì ìœ¼ë¡œ ì´ë²¤íŠ¸ ì²˜ë¦¬ ë¹„í™œì„±í™”í•˜ì—¬ ì¤‘ë³µ í´ë¦­ ë°©ì§€
              video.removeEventListener('click', handleVideoInteraction);
              video.removeEventListener('touchstart', handleVideoInteraction);
              
              setTimeout(() => {
                video.addEventListener('click', handleVideoInteraction, {passive: false, capture: true});
                video.addEventListener('touchstart', handleVideoInteraction, {passive: false, capture: true});
              }, 300);
              
              return false;
            };
            
            // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ë“±ë¡ - ìº¡ì²˜ë§ ë‹¨ê³„ ë° ìˆ˜ë™ ì´ë²¤íŠ¸ ì²˜ë¦¬
            video.addEventListener('click', handleVideoInteraction, {passive: false, capture: true});
            video.addEventListener('touchstart', handleVideoInteraction, {passive: false, capture: true});
            
            // ë¹„ë””ì˜¤ ì»¨íŠ¸ë¡¤ëŸ¬ ì˜ì—­(í•˜ë‹¨ ë°”)ì˜ í´ë¦­/í„°ì¹˜ ì´ë²¤íŠ¸ëŠ” ì›ë˜ ê¸°ëŠ¥ ìœ ì§€
            video.addEventListener('touchstart', function(e) {
              const touch = e.touches[0];
              const videoRect = video.getBoundingClientRect();
              const controlsHeight = videoRect.height * 0.25; // í•˜ë‹¨ 25%ë¥¼ ì»¨íŠ¸ë¡¤ ì˜ì—­ìœ¼ë¡œ ê°„ì£¼
              
              // í„°ì¹˜ ìœ„ì¹˜ê°€ ë¹„ë””ì˜¤ í•˜ë‹¨ ì˜ì—­ì´ë©´ ì»¨íŠ¸ë¡¤ëŸ¬ ì˜ì—­ìœ¼ë¡œ ê°„ì£¼
              if (touch.clientY > (videoRect.bottom - controlsHeight)) {
                console.log('ì»¨íŠ¸ë¡¤ëŸ¬ ì˜ì—­ í„°ì¹˜ ê°ì§€ - ê¸°ë³¸ ê¸°ëŠ¥ í—ˆìš©');
                // ê¸°ë³¸ ì»¨íŠ¸ë¡¤ëŸ¬ ë™ì‘ í—ˆìš©í•˜ê¸° ìœ„í•´ ì´ë²¤íŠ¸ ì „íŒŒ í™•ì‹¤íˆ
                e.stopImmediatePropagation(); // ë‹¤ë¥¸ ë¦¬ìŠ¤ë„ˆ ì‹¤í–‰ ë°©ì§€
                return true; // ê¸°ë³¸ ë™ì‘ í—ˆìš©
              }
            }, {passive: false, capture: true});
            
            // í”Œë ˆì´ ìƒíƒœ ë³€ê²½ ê°ì§€
            video.addEventListener('play', function() {
              console.log('ê¸€ë¡œë²Œ í•¸ë“¤ëŸ¬: ë¹„ë””ì˜¤ ì¬ìƒ ì‹œì‘');
            });
            
            video.addEventListener('pause', function() {
              console.log('ê¸€ë¡œë²Œ í•¸ë“¤ëŸ¬: ë¹„ë””ì˜¤ ì¼ì‹œì •ì§€');
            });
          }
        }, 500);
      }
      
      // í˜ì´ì§€ ë¡œë“œ ì‹œ ë° DOM ë³€ê²½ ê°ì§€í•˜ì—¬ ë¹„ë””ì˜¤ ì œì–´ ì„¤ì •
      setupVideoControls();
      
      // Mutation Observerë¡œ DOM ë³€ê²½ ê°ì§€ (ë¹„ë””ì˜¤ ìš”ì†Œê°€ ë™ì ìœ¼ë¡œ ì¶”ê°€ë  ë•Œ)
      const observer = new MutationObserver(function(mutations) {
        for (const mutation of mutations) {
          if (mutation.addedNodes.length) {
            setupVideoControls();
            break;
          }
        }
      });
      
      // body ì „ì²´ ê´€ì°°
      observer.observe(document.body, { childList: true, subtree: true });
    });
  </script>
</body>
</html>